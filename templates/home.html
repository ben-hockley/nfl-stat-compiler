<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
      th { cursor: pointer; user-select: none; }
      .sort-indicator { font-size: 0.7rem; opacity: 0.8; }
    </style>
  </head>
  <body>
    <div class="container py-3">
      <h1 class="mb-4">NFL Stats 2025</h1>

      <!-- Team filter: select a team or All -->
      <div class="mb-3">
        <label for="teamFilter" class="form-label">Filter by team</label>
        <select id="teamFilter" class="form-select form-select-sm" aria-label="Filter tables by team">
          <option value="ALL">All teams</option>
          <option value="ARI">Arizona Cardinals (ARI)</option>
          <option value="ATL">Atlanta Falcons (ATL)</option>
          <option value="BAL">Baltimore Ravens (BAL)</option>
          <option value="BUF">Buffalo Bills (BUF)</option>
          <option value="CAR">Carolina Panthers (CAR)</option>
          <option value="CHI">Chicago Bears (CHI)</option>
          <option value="CIN">Cincinnati Bengals (CIN)</option>
          <option value="CLE">Cleveland Browns (CLE)</option>
          <option value="DAL">Dallas Cowboys (DAL)</option>
          <option value="DEN">Denver Broncos (DEN)</option>
          <option value="DET">Detroit Lions (DET)</option>
          <option value="GB">Green Bay Packers (GB)</option>
          <option value="HOU">Houston Texans (HOU)</option>
          <option value="IND">Indianapolis Colts (IND)</option>
          <option value="JAX">Jacksonville Jaguars (JAX)</option>
          <option value="KC">Kansas City Chiefs (KC)</option>
          <option value="LAC">Los Angeles Chargers (LAC)</option>
          <option value="LAR">Los Angeles Rams (LAR)</option>
          <option value="LV">Las Vegas Raiders (LV)</option>
          <option value="MIA">Miami Dolphins (MIA)</option>
          <option value="MIN">Minnesota Vikings (MIN)</option>
          <option value="NE">New England Patriots (NE)</option>
          <option value="NO">New Orleans Saints (NO)</option>
          <option value="NYG">New York Giants (NYG)</option>
          <option value="NYJ">New York Jets (NYJ)</option>
          <option value="PHI">Philadelphia Eagles (PHI)</option>
          <option value="PIT">Pittsburgh Steelers (PIT)</option>
          <option value="SEA">Seattle Seahawks (SEA)</option>
          <option value="SF">San Francisco 49ers (SF)</option>
          <option value="TB">Tampa Bay Buccaneers (TB)</option>
          <option value="TEN">Tennessee Titans (TEN)</option>
          <option value="WAS">Washington Commanders (WAS)</option>
        </select>
      </div>

      <div class="row g-3">
        <!-- Passing leaders -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body p-2">
              <h5 class="card-title mb-2">Passing Leaders</h5>
              <div class="table-responsive" style="max-height:320px; overflow:auto;">
                <table class="table table-sm table-striped table-hover mb-0 small">
                  <thead class="table-light">
                    <tr>
                      <th class="align-middle" style="width:40px">#</th>
                      <th>Player</th>
                      <th style="width:80px">Team</th>
                      <th style="width:90px">CMP/ATT</th>
                      <th style="width:80px">Yds</th>
                      <th style="width:60px">TD</th>
                      <th style="width:60px">INT</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for stat in top_passing_stats %}
                      <tr>
                        <td class="align-middle">{{ loop.index }}</td>
                        <td class="align-middle">
                          {% set img = stat[4] %}
                          {% set name = stat[3] %}
                          <div class="d-flex align-items-center">
                            {% if img %}
                              <img src="{{ img }}" alt="{{ name }} photo" class="rounded-circle me-2" style="width:36px;height:36px;object-fit:cover;">
                            {% endif %}
                            <div class="text-truncate" style="max-width:220px;">{{ name }}</div>
                          </div>
                        </td>
                        <td class="align-middle">{{ stat[1] }}</td>
                        <td class="align-middle">{{ stat[5] }}</td>
                        <td class="align-middle">{{ stat[6] }}</td>
                        <td class="align-middle">{{ stat[7] }}</td>
                        <td class="align-middle">{{ stat[8] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Rushing leaders -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body p-2">
              <h5 class="card-title mb-2">Rushing Leaders</h5>
              <div class="table-responsive" style="max-height:320px; overflow:auto;">
                <table class="table table-sm table-striped table-hover mb-0 small">
                  <thead class="table-light">
                    <tr>
                      <th style="width:40px">#</th>
                      <th>Player</th>
                      <th style="width:80px">Team</th>
                      <th style="width:70px">Att</th>
                      <th style="width:80px">Yds</th>
                      <th style="width:60px">TD</th>
                      <th style="width:70px">Lng</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for stat in top_rushing_stats %}
                      <tr>
                        <td class="align-middle">{{ loop.index }}</td>
                        <td class="align-middle">
                          {% set img = stat[4] %}
                          {% set name = stat[3] %}
                          <div class="d-flex align-items-center">
                            {% if img %}
                              <img src="{{ img }}" alt="{{ name }} photo" class="rounded-circle me-2" style="width:36px;height:36px;object-fit:cover;">
                            {% endif %}
                            <div class="text-truncate" style="max-width:220px;">{{ name }}</div>
                          </div>
                        </td>
                        <td class="align-middle">{{ stat[1] }}</td>
                        <td class="align-middle">{{ stat[5] }}</td>
                        <td class="align-middle">{{ stat[6] }}</td>
                        <td class="align-middle">{{ stat[7] }}</td>
                        <td class="align-middle">{{ stat[8] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Receiving leaders -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body p-2">
              <h5 class="card-title mb-2">Receiving Leaders</h5>
              <div class="table-responsive" style="max-height:320px; overflow:auto;">
                <table class="table table-sm table-striped table-hover mb-0 small">
                  <thead class="table-light">
                    <tr>
                      <th style="width:40px">#</th>
                      <th>Player</th>
                      <th style="width:80px">Team</th>
                      <th style="width:70px">Rec</th>
                      <th style="width:80px">Yds</th>
                      <th style="width:60px">TD</th>
                      <th style="width:70px">Lng</th>
                      <th style="width:70px">TGTS</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for stat in top_receiving_stats %}
                      <tr>
                        <td class="align-middle">{{ loop.index }}</td>
                        <td class="align-middle">
                          {% set img = stat[4] %}
                          {% set name = stat[3] %}
                          <div class="d-flex align-items-center">
                            {% if img %}
                              <img src="{{ img }}" alt="{{ name }} photo" class="rounded-circle me-2" style="width:36px;height:36px;object-fit:cover;">
                            {% endif %}
                            <div class="text-truncate" style="max-width:220px;">{{ name }}</div>
                          </div>
                        </td>
                        <td class="align-middle">{{ stat[1] if stat|length > 1 else '' }}</td>
                        <td class="align-middle">{{ stat[5] }}</td>
                        <td class="align-middle">{{ stat[6] }}</td>
                        <td class="align-middle">{{ stat[7] }}</td>
                        <td class="align-middle">{{ stat[8] }}</td>
                        <td class="align-middle">{{ stat[9] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Tackling / Defensive leaders -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body p-2">
              <h5 class="card-title mb-2">Tackling Leaders</h5>
              <div class="table-responsive" style="max-height:320px; overflow:auto;">
                <table class="table table-sm table-striped table-hover mb-0 small">
                  <thead class="table-light">
                    <tr>
                      <th style="width:40px">#</th>
                      <th>Player</th>
                      <th style="width:80px">Team</th>
                      <th style="width:60px">Tck</th>
                      <th style="width:70px">Solo</th>
                      <th style="width:70px">Sacks</th>
                      <th style="width:60px">TFL</th>
                      <th style="width:70px">PD</th>
                      <th style="width:60px">QB Hits</th>
                      <th style="width:60px">TDs</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for stat in top_defensive_stats %}
                      <tr>
                        <td class="align-middle">{{ loop.index }}</td>
                        <td class="align-middle">
                          {% set img = stat[4] %}
                          {% set name = stat[3] %}
                          <div class="d-flex align-items-center">
                            {% if img %}
                              <img src="{{ img }}" alt="{{ name }} photo" class="rounded-circle me-2" style="width:36px;height:36px;object-fit:cover;">
                            {% endif %}
                            <div class="text-truncate" style="max-width:220px;">{{ name }}</div>
                          </div>
                        </td>
                        <td class="align-middle">{{ stat[1] }}</td>
                        <td class="align-middle">{{ stat[5] }}</td>
                        <td class="align-middle">{{ stat[6] }}</td>
                        <td class="align-middle">{{ stat[7] }}</td>
                        <td class="align-middle">{{ stat[8] }}</td>
                        <td class="align-middle">{{ stat[9] }}</td>
                        <td class="align-middle">{{ stat[10] }}</td>
                        <td class="align-middle">{{ stat[11] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Fumbles leaders -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body p-2">
              <h5 class="card-title mb-2">Fumbles Leaders</h5>
              <div class="table-responsive" style="max-height:320px; overflow:auto;">
                <table class="table table-sm table-striped table-hover mb-0 small">
                  <thead class="table-light">
                    <tr>
                      <th style="width:40px">#</th>
                      <th>Player</th>
                      <th style="width:80px">Team</th>
                      <th style="width:80px">Fumbles</th>
                      <th style="width:80px">Lost</th>
                      <th style="width:80px">Recovered</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for stat in top_fumbles_stats %}
                      <tr>
                        <td class="align-middle">{{ loop.index }}</td>
                        <td class="align-middle">
                          {% set img = stat[4] %}
                          {% set name = stat[3] %}
                          <div class="d-flex align-items-center">
                            {% if img %}
                              <img src="{{ img }}" alt="{{ name }} photo" class="rounded-circle me-2" style="width:36px;height:36px;object-fit:cover;">
                            {% endif %}
                            <div class="text-truncate" style="max-width:220px;">{{ name }}</div>
                          </div>
                        </td>
                        <td class="align-middle">{{ stat[1] }}</td>
                        <td class="align-middle">{{ stat[5] }}</td>
                        <td class="align-middle">{{ stat[6] }}</td>
                        <td class="align-middle">{{ stat[7] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Interceptions leaders -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body p-2">
              <h5 class="card-title mb-2">Interceptions Leaders</h5>
              <div class="table-responsive" style="max-height:320px; overflow:auto;">
                <table class="table table-sm table-striped table-hover mb-0 small">
                  <thead class="table-light">
                    <tr>
                      <th style="width:40px">#</th>
                      <th>Player</th>
                      <th style="width:80px">Team</th>
                      <th style="width:60px">INT</th>
                      <th style="width:80px">Yds</th>
                      <th style="width:60px">TD</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for stat in top_interceptions_stats %}
                      <tr>
                        <td class="align-middle">{{ loop.index }}</td>
                        <td class="align-middle">
                          {% set img = stat[4] %}
                          {% set name = stat[3] %}
                          <div class="d-flex align-items-center">
                            {% if img %}
                              <img src="{{ img }}" alt="{{ name }} photo" class="rounded-circle me-2" style="width:36px;height:36px;object-fit:cover;">
                            {% endif %}
                            <div class="text-truncate" style="max-width:220px;">{{ name }}</div>
                          </div>
                        </td>
                        <td class="align-middle">{{ stat[1] }}</td>
                        <td class="align-middle">{{ stat[5] }}</td>
                        <td class="align-middle">{{ stat[6] }}</td>
                        <td class="align-middle">{{ stat[7] }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </div>
      <!-- end row -->

    </div>

    <script>
      (function(){
        // small helper: get visible text from a cell (supports .text-truncate inside player cell)
        function getCellText(cell){
          if(!cell) return '';
          const tg = cell.querySelector('.text-truncate');
          return (tg ? tg.textContent : cell.textContent).trim();
        }
        function parseNumber(s){
          if(!s) return null;
          const cleaned = s.replace(/\u2011/g,'-').replace(/[,()]/g,'');
          const m = cleaned.match(/-?\d+(\.\d+)?/);
          return m ? parseFloat(m[0]) : null;
        }

        // Sorting: clicking any table header sorts that table's body
        document.querySelectorAll('table').forEach(table=>{
          const thead = table.querySelector('thead');
          const tbody = table.querySelector('tbody');
          if(!thead || !tbody) return;
          Array.from(thead.querySelectorAll('th')).forEach((th, colIdx)=>{
            th.addEventListener('click', ()=>{
              const current = th.dataset.order === 'asc' ? 'desc' : 'asc';
              thead.querySelectorAll('th').forEach(h=>{
                h.dataset.order = '';
                const si = h.querySelector('.sort-indicator'); if(si) si.textContent = '';
              });
              th.dataset.order = current;
              let indicator = th.querySelector('.sort-indicator');
              if(!indicator){ indicator = document.createElement('span'); indicator.className='sort-indicator ms-1'; th.appendChild(indicator); }
              indicator.textContent = current === 'asc' ? '▲' : '▼';

              const rows = Array.from(tbody.querySelectorAll('tr'));
              rows.sort((a,b)=>{
                const aText = getCellText(a.children[colIdx]);
                const bText = getCellText(b.children[colIdx]);
                const aNum = parseNumber(aText);
                const bNum = parseNumber(bText);
                if(aNum !== null && bNum !== null){
                  return current === 'asc' ? aNum - bNum : bNum - aNum;
                }
                return current === 'asc' ? aText.localeCompare(bText, undefined, {numeric:true}) : bText.localeCompare(aText, undefined, {numeric:true});
              });
              rows.forEach(r => tbody.appendChild(r));
            });
          });
        });

        // Team filter: map abbreviations to full names (used to match either form in table's team cell)
        const teamMap = {
          ARI: 'Arizona Cardinals', ATL: 'Atlanta Falcons', BAL: 'Baltimore Ravens', BUF: 'Buffalo Bills',
          CAR: 'Carolina Panthers', CHI: 'Chicago Bears', CIN: 'Cincinnati Bengals', CLE: 'Cleveland Browns',
          DAL: 'Dallas Cowboys', DEN: 'Denver Broncos', DET: 'Detroit Lions', GB: 'Green Bay Packers',
          HOU: 'Houston Texans', IND: 'Indianapolis Colts', JAX: 'Jacksonville Jaguars', KC: 'Kansas City Chiefs',
          LAC: 'Los Angeles Chargers', LAR: 'Los Angeles Rams', LV: 'Las Vegas Raiders', MIA: 'Miami Dolphins',
          MIN: 'Minnesota Vikings', NE: 'New England Patriots', NO: 'New Orleans Saints', NYG: 'New York Giants',
          NYJ: 'New York Jets', PHI: 'Philadelphia Eagles', PIT: 'Pittsburgh Steelers', SEA: 'Seattle Seahawks',
          SF: 'San Francisco 49ers', TB: 'Tampa Bay Buccaneers', TEN: 'Tennessee Titans', WAS: 'Washington Commanders'
        };

        function teamMatches(teamText, selected){
          if(!selected || selected === 'ALL') return true;
          if(!teamText) return false;
          const t = teamText.trim().toUpperCase();
          const sel = selected.toUpperCase();
          if(t === sel) return true; // exact abbr
          if(t.includes(sel)) return true; // e.g., cell contains 'NE' or abbreviation somewhere
          const full = teamMap[sel];
          if(full && t.includes(full.toUpperCase())) return true; // match full name
          // also accept matches where cell is like 'New England (NE)'
          if(full && t.includes(sel) ) return true;
          return false;
        }

        function filterTablesByTeam(selected){
          const tables = document.querySelectorAll('table');
          tables.forEach(table=>{
            const tbody = table.querySelector('tbody');
            if(!tbody) return;
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row=>{
              // assume team is in third column (td:nth-child(3)) across your tables
              const teamCell = row.querySelector('td:nth-child(3)');
              const teamText = teamCell ? teamCell.textContent : '';
              if(teamMatches(teamText, selected)){
                row.style.display = '';
              } else {
                row.style.display = 'none';
              }
            });
          });
        }

        const filterEl = document.getElementById('teamFilter');
        if(filterEl){
          filterEl.addEventListener('change', (e)=>{
            filterTablesByTeam(e.target.value);
          });
          // apply default filter on load (show all)
          filterTablesByTeam(filterEl.value || 'ALL');
        }

      })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>
  </body>
</html>
